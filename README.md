# mayday

Сервис алертинга, отвечающий за управление конфигурациями алертов

## Роль сервиса в системе алертинга

Приблизительная схема системы алертинга выглядит следующим образом:

![схема системы алертинга](./img/alerting.svg)


Сервис mayday содержит следующий функционал:

 - Создание алертов
 - Удаление алертов
 - Получение списка алертов пользователя
 - Отправка уведомлений об алертах получателям

Взаимодействие с сервисом осуществляется через [протокол](https://github.com/valitydev/mayday-proto).
Сам сервис не хранит состояния - все действующие алерты создаются и хранятся внутри сервисов prometheus и alertmanager

## Внутреннее устройство сервиса

### Структура проекта

Проект использует [feature-layered](https://phauer.com/2020/package-by-feature/) структуру пакетов. 
Взаимодействие с prometheus, взаимодействие с alertmanager, формирование конфигураций алертов и протокол для взаимодействия с сервисом разнесены по разным корневым каталогам.
Это позволяет вносить правки в конкретную "фичу" и не бояться, что они сломают соседний функционал. 
Поскольку в сервисе есть элементы, которые переиспользуются для всех "фич" - эти классы вынесены в пакет [common](src/main/java/dev/vality/alerting/mayday/common).

Если вас интересует не определенный функционал сервиса, а общее понимание его устройства, то лучше начать изучение кодовой базы с класса [AlertingService](src/main/java/dev/vality/alerting/mayday/thrift/service/AlertingService.java) - он реализует [thrift-протокол](https://github.com/valitydev/mayday-proto), через который и осуществляется взаимодействие с сервисом.

#### prometheus-operator

Сервис "общается" с prometheus'ом и alertmanager'ом через [API](https://prometheus-operator.dev/docs/operator/api/), которое предоставляет [prometheus-operator](https://prometheus-operator.dev/).

##### prometheus
##### alertmanager
#### Конфигурации алертов
#### Thrift

### Запуск и отладка сервиса на локальной машине
## Известные проблемы

